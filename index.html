<script>
(function () {
    function getQuizPassword() {
        const timerElement = document.querySelector("#time_running");
        if (!timerElement) return null;

        const timeText = timerElement.textContent.trim();
        const timeParts = timeText.match(/(\d+)\s*Hour.*?(\d+)\s*Minute/);

        if (timeParts) {
            return `Password${timeParts[1]}H${timeParts[2]}M`;
        }
        return null;
    }

    function startQuizProtection() {
        alert("‚ö†Ô∏è Switching browser tabs or exiting the CANVAS QUIZ tab is strictly prohibited!\n\nCANVAS logs all quiz activities, and if you are found to have disregarded this rule, you will be penalized based on the total time spent outside the quiz.");

        document.addEventListener("visibilitychange", function () {
            if (document.hidden) {
                alert("‚ö†Ô∏è You have switched tabs! This is not allowed.");

                let correctPassword = getQuizPassword();
                if (!correctPassword) {
                    alert("‚ùå Unable to retrieve the quiz timer. Please refresh and try again.");
                    return;
                }

                let password;
                while (password !== correctPassword) {
                    password = prompt(`üîë Enter the password to continue (Hint: Based on quiz time)`);
                    if (password === null || password.trim() === "") {
                        alert("‚ùå You must enter the correct password to continue!");
                    }
                }
            }
        });

        window.addEventListener("beforeunload", function (event) {
            event.preventDefault();
            event.returnValue = "‚ö†Ô∏è Exiting this page is prohibited!";
        });
    }

    function checkCanvasQuiz() {
        const quizForm = document.querySelector("#submit_quiz_form");
        if (quizForm) {
            startQuizProtection();
        } else {
            setTimeout(checkCanvasQuiz, 1000);
        }
    }

    checkCanvasQuiz();
})();

</script>
